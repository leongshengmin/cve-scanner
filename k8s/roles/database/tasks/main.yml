---
- name: Create a k8s namespace
  k8s:
    name: cs3219
    api_version: v1
    kind: Namespace
    state: present

- name: Create cm for init script
  command: "kubectl create configmap init-databse --from-file=../database/init.sql"

- name: Generate k8s depl files from tmpl
  template:
    src: "mysql.yml"
    dest: "{{manifest_base_dir}}/mysql.yml"

- name: Generate k8s storage files from tmpl
  template:
    src: "pvc.yml"
    dest: "{{manifest_base_dir}}/pvc.yml"

- name: Apply k8s depl manifests
  k8s:
    state: present
    src: "{{manifest_base_dir}}/mysql.yml"

- name: Apply k8s storage manifests
  k8s:
    state: present
    src: "{{manifest_base_dir}}/pvc.yml"
