const dockerCLI = require('docker-cli-js');
const DockerOptions = dockerCLI.Options;
const Docker = dockerCLI.Docker;

const options = new DockerOptions(
  null,
  null,
  true,
);
const docker = new Docker(options);

function login(username, password) {
  return new Promise((resolve, reject) => {
    docker
      .command(`login -u ${username} -p ${password}`)
      .then(res => resolve(res))
      .catch(err => reject(err));
  });
}

function buildAndPush(imageRepoUri, sourceCodeRepoUri) {
  return new Promise(((resolve, reject) => {
    docker.command(`build -t ${imageRepoUri} ${sourceCodeRepoUri}.git`)
      .then(() => docker.command(`push ${imageRepoUri}`)
        .then(res => resolve(res))
        .catch(err => reject(err)));
  }));
}

module.exports = {
  login: login,
  buildAndPush: buildAndPush,
}